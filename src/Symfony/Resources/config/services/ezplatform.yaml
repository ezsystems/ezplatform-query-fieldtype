services:
    _defaults:
        public: false
        autowire: true
        autoconfigure: true

    EzSystems\EzPlatformQueryFieldType\eZ\FieldType\Query\Type:
        parent: ezpublish.fieldType
        public: true
        autowire: true
        autoconfigure: false
        tags:
            - { name: ezpublish.fieldType, alias: '%ezcontentquery_identifier%' }
        arguments:
            $queryTypeRegistry: '@ezpublish.query_type.registry'
            $identifier: '%ezcontentquery_identifier%'

    EzSystems\EzPlatformQueryFieldType\eZ\FieldType\Mapper\QueryFormMapper:
        tags:
            - { name: ez.fieldFormMapper.definition, fieldType: '%ezcontentquery_identifier%' }
            - { name: ez.fieldFormMapper.value, fieldType: '%ezcontentquery_identifier%' }
        arguments:
            $contentTypeService: '@ezpublish.api.service.content_type'

    EzSystems\EzPlatformQueryFieldType\eZ\FieldType\Form\QueryFieldFormType: ~

    EzSystems\EzPlatformQueryFieldType\eZ\Persistence\Legacy\Content\FieldValue\Converter\QueryConverter:
        tags:
            - { name: ezpublish.storageEngine.legacy.converter, alias: '%ezcontentquery_identifier%' }

    EzSystems\EzPlatformQueryFieldType\eZ\FieldType\Query\SearchField:
        tags:
            - { name: ezpublish.fieldType.indexable, alias: '%ezcontentquery_identifier%' }

    EzSystems\EzPlatformQueryFieldType\eZ\ContentView\FieldDefinitionIdentifierMatcher:
        calls:
            - [setRepository, ['@ezpublish.api.repository']]

    Identifier\FieldDefinition: '@EzSystems\EzPlatformQueryFieldType\eZ\ContentView\FieldDefinitionIdentifierMatcher'

    EzSystems\EzPlatformQueryFieldType\eZ\ContentView\QueryResultsInjector:
        arguments:
            $views: { field: '%ezcontentquery_field_view%', item: '%ezcontentquery_item_view%' }
        tags:
            - { name: kernel.event_subscriber }
